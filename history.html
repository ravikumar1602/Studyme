<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Videos - StudyZone</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/theme.css">
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/3.0.1/Youtube.min.css" rel="stylesheet" />
    <style>
        /* Page-specific styles */
        .page-layout {
            display: grid;
            grid-template-columns: 1fr 3fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .main-content {
            grid-column: 2;
        }
        
        .video-container {
            position: relative;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            background: #000;
        }
        
        .video-js {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        }
        
        .video-js .vjs-tech {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Video Grid Styles */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .video-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .video-thumbnail {
            position: relative;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: #000;
        }
        
        .video-thumbnail img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .video-card-info {
            padding: 15px;
        }
        
        .video-card h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .video-card-meta {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 14px;
        }
        
        /* Playlist styles */
        .playlist-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 800px;
            overflow-y: auto;
        }
        
        .playlist-header {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
            color: #333;
        }
        
        .playlist {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .playlist-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            background: #fff;
            border: 1px solid #e0e0e0;
        }
        
        .playlist-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        
        .playlist-item.active {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
        }
        
        .playlist-item-number {
            width: 25px;
            height: 25px;
            background: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .playlist-item.active .playlist-item-number {
            background: #1976d2;
            color: white;
        }
        
        .playlist-item-title {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .page-layout {
                grid-template-columns: 1fr 2fr;
            }
            .playlist-panel {
                grid-column: 1 / -1;
                order: 3;
                max-height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .page-layout {
                grid-template-columns: 1fr;
            }
            .main-content {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header will be loaded here -->
    <header id="header"></header>

    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <h1>History Video Lectures</h1>
            <p>Learn from expert history teachers and explore historical events in detail</p>
        </div>
    </div>

    <div class="container">
        <div class="page-layout">
            <!-- Teacher Panel -->
            <aside class="teacher-panel">
                <h2>Our History Teachers</h2>
                <ul class="teacher-list" id="teacherList">
                    <li class="teacher-item active" data-teacher="khan">
                        <div class="teacher-avatar">KS</div>
                        <div class="teacher-info">
                            <h3>Khan Sir</h3>
                            <p>Ancient History Expert</p>
                        </div>
                    </li>
                    <li class="teacher-item" data-teacher="sarah">
                        <div class="teacher-avatar">SJ</div>
                        <div class="teacher-info">
                            <h3>Sarah Johnson</h3>
                            <p>World Wars Specialist</p>
                        </div>
                    </li>
                    <li class="teacher-item" data-teacher="michael">
                        <div class="teacher-avatar">MB</div>
                        <div class="teacher-info">
                            <h3>Michael Brown</h3>
                            <p>Modern History Professor</p>
                        </div>
                    </li>
                    <li class="teacher-item" data-teacher="priya">
                        <div class="teacher-avatar">PP</div>
                        <div class="teacher-info">
                            <h3>Priya Patel</h3>
                            <p>Cultural History Expert</p>
                        </div>
                    </li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Video Player -->
                <div class="video-container">
                    <video id="history-video" class="video-js vjs-default-skin" controls preload="auto" data-setup='{}'>
                        <p class="vjs-no-js">
                            To view this video please enable JavaScript, and consider upgrading to a
                            web browser that
                            <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                        </p>
                    </video>
                </div>

                <!-- Video Info -->
                <div class="video-info">
                    <h2 id="videoTitle">Select a video to start watching</h2>
                    <div class="video-meta">
                        <span id="videoDuration">-</span>
                        <span>•</span>
                        <span id="videoViews">- views</span>
                        <span>•</span>
                        <span id="videoDate">-</span>
                    </div>
                    <p class="video-description" id="videoDescription">
                        Choose a teacher from the left panel to browse their collection of history lectures.
                    </p>
                </div>
                
                <!-- Video List -->
                <div class="video-grid" id="videoList">
                    <!-- Videos will be loaded here -->
                </div>
            </main>
            
            <!-- Playlist Panel -->
            <aside class="playlist-panel">
                <div class="playlist-header">Playlist</div>
                <ul class="playlist" id="playlist">
                    <!-- Playlist items will be loaded here by JavaScript -->
                </ul>
            </aside>
        </div>
    </div>

    <!-- Footer will be loaded here -->
    <footer id="footer"></footer>

    <!-- Video.js -->
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/3.0.1/Youtube.min.js"></script>
    <script src="js/video-config.js"></script>
    <script>
        // Use the teachersData from video-config.js
        const teachersData = {};
        
        // Convert videoConfig.teachers array to the expected format
        if (window.videoConfig && window.videoConfig.teachers) {
            window.videoConfig.teachers.forEach(teacher => {
                teachersData[teacher.id] = {
                    name: teacher.name,
                    specialization: teacher.specialization,
                    avatar: teacher.avatar,
                    videos: teacher.videos
                };
            });
        }

        // DOM Elements
        const teacherItems = document.querySelectorAll('.teacher-item');
        const videoList = document.getElementById('videoList');
        const videoTitle = document.getElementById('videoTitle');
        const videoDuration = document.getElementById('videoDuration');
        const videoViews = document.getElementById('videoViews');
        const videoDate = document.getElementById('videoDate');
        const videoDescription = document.getElementById('videoDescription');

        // Initialize Video.js with YouTube tech
        let player;
        
        // Wait for the YouTube API to be ready
        function initPlayer() {
            player = videojs('history-video', {
                techOrder: ['youtube'],
                autoplay: false,
                controls: true,
                sources: [{
                    src: 'about:blank',
                    type: 'video/youtube'
                }],
                youtube: {
                    ytControls: 2,
                    rel: 0,
                    showinfo: 0,
                    fs: 1,
                    modestbranding: 1,
                    iv_load_policy: 3
                }
            });
            
            // Make player available globally for debugging
            window.player = player;
            
            // Load first teacher's videos after player is ready
            if (teacherItems.length > 0) {
                teacherItems[0].click();
            }
        }
        
        // Initialize the player when the YouTube API is ready
        if (window.YT && YT.loaded) {
            initPlayer();
        } else {
            // If YouTube API isn't loaded yet, wait for it
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            
            // This function will be called when the YouTube API is ready
            window.onYouTubeIframeAPIReady = function() {
                initPlayer();
            };
        }

        // Load teacher's videos when clicked
        teacherItems.forEach(item => {
            item.addEventListener('click', function() {
                const teacherId = this.getAttribute('data-teacher');
                console.log('Teacher clicked:', teacherId);
                const teacher = teachersData[teacherId];
                console.log('Teacher data:', teacher);
                
                if (!teacher) {
                    console.error('Teacher not found:', teacherId);
                    return;
                }
                
                // Update active state
                teacherItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Load teacher's videos
                loadTeacherVideos(teacher);
                
                // Update playlist
                updatePlaylist(teacher);
            });
        });
        
        // Function to update the playlist
        function updatePlaylist(teacher) {
            const playlistElement = document.getElementById('playlist');
            playlistElement.innerHTML = ''; // Clear existing playlist
            
            if (!teacher || !teacher.videos || teacher.videos.length === 0) {
                playlistElement.innerHTML = '<li class="playlist-empty">No videos available</li>';
                return;
            }
            
            teacher.videos.forEach((video, index) => {
                const li = document.createElement('li');
                li.className = 'playlist-item';
                li.setAttribute('data-video-id', video.id);
                
                li.innerHTML = `
                    <div class="playlist-item-number">${index + 1}</div>
                    <div class="playlist-item-title" title="${video.title}">${video.title}</div>
                `;
                
                // Add click event to play the video
                li.addEventListener('click', () => {
                    // Remove active class from all items
                    document.querySelectorAll('.playlist-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    li.classList.add('active');
                    
                    // Play the selected video
                    playVideo(video);
                });
                
                playlistElement.appendChild(li);
            });
            
            // Auto-select first video in playlist
            if (teacher.videos.length > 0) {
                const firstVideo = teacher.videos[0];
                playVideo(firstVideo);
                // Add active class to first item
                const firstItem = playlistElement.querySelector('.playlist-item');
                if (firstItem) firstItem.classList.add('active');
            }
        }

        // Load videos for the selected teacher
        function loadTeacherVideos(teacher) {
            if (!teacher || !teacher.videos) {
                console.error('No teacher or videos found');
                return;
            }
            
            console.log('Loading videos for teacher:', teacher.name, teacher.videos);
            
            // Clear previous videos
            videoList.innerHTML = '';
            
            // Create video grid items
            teacher.videos.forEach((video, index) => {
                console.log('Adding video to grid:', video.title);
                const videoItem = document.createElement('div');
                videoItem.className = 'video-card';
                videoItem.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}" loading="lazy">
                        <div class="video-duration">${video.duration}</div>
                    </div>
                    <div class="video-card-info">
                        <h3>${video.title}</h3>
                        <div class="video-card-meta">
                            <span>${video.views} views</span>
                            <span>${video.date}</span>
                        </div>
                    </div>
                `;
                
                // Play video when clicked
                videoItem.addEventListener('click', () => playVideo(video));
                
                videoList.appendChild(videoItem);
            });
        }
        
        // Play the selected video
        function playVideo(video) {
            if (!player) {
                console.error('Video.js player not initialized');
                return;
            }
            
            console.log('Playing video:', video);
            
            // Create the video source URL
            let videoSrc = `https://www.youtube.com/watch?v=${video.id}`;
            
            // Update video source
            try {
                player.src({
                    src: videoSrc,
                    type: 'video/youtube'
                });
                
                // Update video info
                videoTitle.textContent = video.title;
                videoDuration.textContent = video.duration;
                videoViews.textContent = `${video.views} views`;
                videoDate.textContent = video.date;
                videoDescription.textContent = video.description;
                
                // Update active state in playlist
                updateActivePlaylistItem(video.id);
                
                // Play the video when ready
                player.one('loadeddata', function() {
                    console.log('Video loaded, attempting to play...');
                    player.play().then(function() {
                        console.log('Playback started');
                    }).catch(function(error) {
                        console.error('Error playing video:', error);
                        // Try autoplay with muted if there's an error
                        player.muted(true);
                        player.play();
                    });
                });
                
                // Handle video end to play next video in playlist
                player.one('ended', function() {
                    playNextVideo(video);
                });
                
                // Handle any errors
                player.on('error', function() {
                    console.error('Video error:', player.error());
                });
                
                // Scroll to top of video
                document.querySelector('.video-container').scrollIntoView({
                    behavior: 'smooth'
                });
                
            } catch (error) {
                console.error('Error setting video source:', error);
            }
        }
        
        // Update active state in playlist
        function updateActivePlaylistItem(videoId) {
            const playlistItems = document.querySelectorAll('.playlist-item');
            playlistItems.forEach(item => {
                if (item.getAttribute('data-video-id') === videoId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        // Play next video in playlist
        function playNextVideo(currentVideo) {
            const teacherId = document.querySelector('.teacher-item.active')?.getAttribute('data-teacher');
            if (!teacherId) return;
            
            const teacher = teachersData[teacherId];
            if (!teacher || !teacher.videos) return;
            
            const currentIndex = teacher.videos.findIndex(v => v.id === currentVideo.id);
            if (currentIndex === -1 || currentIndex >= teacher.videos.length - 1) return;
            
            // Play next video
            const nextVideo = teacher.videos[currentIndex + 1];
            playVideo(nextVideo);
        }
        
        // Moved to initPlayer function to ensure player is ready

        // Load header and footer
        document.addEventListener('DOMContentLoaded', () => {
            fetch('header.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('header').innerHTML = html;
                });
                
            fetch('footer.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('footer').innerHTML = html;
                });
        });
    </script>
</body>
</html>